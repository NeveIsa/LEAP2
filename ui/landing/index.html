<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="LEAP2 â€” Live Experiments for Active Pedagogy. Browse and launch classroom experiments.">
  <meta property="og:title" content="LEAP2">
  <meta property="og:description" content="Live Experiments for Active Pedagogy">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ§ª</text></svg>">
  <title>LEAP2</title>
  <script>(function(){var t=localStorage.getItem("leap-theme");if(t==="dark"||(!t&&matchMedia("(prefers-color-scheme:dark)").matches))document.documentElement.classList.add("dark")})()</script>
  <link rel="stylesheet" href="/static/theme.css">
  <script src="/static/theme-toggle.js" defer></script>
  <style>
    .navbar-tagline {
      color: var(--color-text);
      font-size: 0.875rem;
      font-weight: 400;
      opacity: 0.65;
      letter-spacing: 0.01em;
    }
    @media (max-width: 768px) {
      .navbar-tagline { display: none; }
    }

    .hero-version {
      display: inline-block;
      font-size: 0.75rem;
      font-weight: 500;
      padding: 0.125rem 0.625rem;
      border-radius: 999px;
      background: var(--color-primary-light);
      color: var(--color-primary);
    }

    .search-bar {
      max-width: 220px;
      flex: 1;
      min-width: 120px;
      position: relative;
    }
    @media (max-width: 768px) {
      .search-bar { display: none !important; }
    }
    .search-bar svg {
      position: absolute;
      left: 0.625rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--color-text-muted);
      pointer-events: none;
      width: 14px;
      height: 14px;
    }
    .search-bar input {
      width: 100%;
      padding: 0.375rem 0.625rem 0.375rem 2rem;
      min-height: 2rem;
      font-size: 0.8125rem;
      font-family: var(--font-sans);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      background: var(--color-surface);
      color: var(--color-text);
      outline: none;
      transition: border-color var(--transition), box-shadow var(--transition);
    }
    .search-bar input:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 2px var(--color-primary-light);
    }
    .search-bar input::placeholder { color: var(--color-text-muted); }

    .card-meta {
      display: flex;
      gap: 0.5rem;
      font-size: 0.75rem;
      color: var(--color-text-muted);
      flex-wrap: wrap;
      margin-bottom: 0.25rem;
    }

    @keyframes shimmer {
      0% { background-position: -400px 0; }
      100% { background-position: 400px 0; }
    }
    .skeleton-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
    }
    .skeleton-line {
      height: 0.875rem;
      border-radius: 4px;
      background: linear-gradient(90deg, var(--color-border) 25%, var(--color-bg) 50%, var(--color-border) 75%);
      background-size: 800px 100%;
      animation: shimmer 1.5s infinite linear;
      margin-bottom: 0.75rem;
    }
    .skeleton-line.w60 { width: 60%; }
    .skeleton-line.w80 { width: 80%; }
    .skeleton-line.w40 { width: 40%; height: 0.75rem; }
    .skeleton-line:last-child { margin-bottom: 0; }

    .empty-state svg {
      margin-bottom: 1rem;
      color: var(--color-text-muted);
      opacity: 0.5;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .card-animate {
      animation: fadeInUp 0.35s ease both;
    }

    .no-results {
      text-align: center;
      padding: 2rem 1rem;
      color: var(--color-text-muted);
      font-size: 0.9375rem;
    }

  </style>
</head>
<body>
  <a class="skip-to-content" href="#main">Skip to content</a>

  <nav class="navbar">
    <div style="display:flex;align-items:center;gap:.75rem;min-width:0;">
      <a class="navbar-brand" href="/"><span>LEAP</span>2</a>
      <span class="navbar-tagline">Live Experiments for Active Pedagogy</span>
    </div>
    <button class="nav-hamburger" id="nav-hamburger" aria-label="Menu">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    <div class="search-bar hidden" id="search-bar" style="margin:0">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" id="search-input" placeholder="Search experiments...">
    </div>
    <div class="navbar-links">
      <span class="hero-version" id="version-badge"></span>
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
        <svg class="icon-sun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        <svg class="icon-moon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      </button>
      <a href="/login" class="btn" style="font-size:.8125rem;padding:.375rem .875rem;color:var(--color-warning);border-color:var(--color-warning);">Admin Login</a>
    </div>
  </nav>

  <main class="container" id="main" style="padding-top:1.5rem;">

    <div id="loading" class="grid">
      <div class="skeleton-card"><div class="skeleton-line w60"></div><div class="skeleton-line w80"></div><div class="skeleton-line w40"></div></div>
      <div class="skeleton-card"><div class="skeleton-line w60"></div><div class="skeleton-line w80"></div><div class="skeleton-line w40"></div></div>
      <div class="skeleton-card"><div class="skeleton-line w60"></div><div class="skeleton-line w80"></div><div class="skeleton-line w40"></div></div>
    </div>

    <div id="error" class="alert alert-error hidden"></div>

    <div id="empty" class="empty-state hidden">
      <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 3h6l1 7H8L9 3z"/><path d="M8 10c-1 0-3 1.5-3 5s1 5 3 6h8c2-1 3-2.5 3-6s-2-5-3-5"/><line x1="12" y1="3" x2="12" y2="1"/></svg>
      <h2>No experiments yet</h2>
      <p>Get started by creating your first experiment:</p>
      <p><code>leap new my-experiment</code></p>
    </div>

    <div id="experiments" class="grid"></div>

    <div id="no-results" class="no-results hidden">No experiments match your search.</div>
  </main>

  <footer class="site-footer">
    <a href="/docs">API Docs</a> <span class="footer-sep">&middot;</span>
    <a href="/login" class="footer-admin">Admin</a> <span class="footer-sep">&middot;</span>
    <a href="https://github.com/neveisa/LEAP2" target="_blank" rel="noopener">GitHub</a>
    <br>
    <span class="footer-meta">
      <span class="footer-status"><span class="footer-dot offline" id="ft-dot"></span> <span id="ft-status">...</span></span>
      <span class="footer-sep">&middot;</span>
      <span id="ft-info"></span>
    </span>
  </footer>
  <script>(function(){fetch("/api/health").then(function(r){return r.json()}).then(function(d){document.getElementById("ft-dot").classList.remove("offline");document.getElementById("ft-status").textContent="Healthy";var v=d.version?"v"+d.version:"";document.getElementById("ft-info").textContent=v}).catch(function(){document.getElementById("ft-status").textContent="Offline"});fetch("/api/experiments").then(function(r){return r.json()}).then(function(d){var n=(d.experiments||[]).length;var info=document.getElementById("ft-info");if(n>0)info.textContent=(info.textContent?info.textContent+" \u00b7 ":"")+"Serving "+n+" experiment"+(n!==1?"s":"")}).catch(function(){})})()</script>
  <script>
    (async function () {
      var grid = document.getElementById("experiments");
      var loading = document.getElementById("loading");
      var empty = document.getElementById("empty");
      var errorEl = document.getElementById("error");
      var searchBar = document.getElementById("search-bar");
      var searchInput = document.getElementById("search-input");
      var noResults = document.getElementById("no-results");
      var allCards = [];

      try {
        var healthRes = await fetch("/api/health");
        if (healthRes.ok) {
          var healthData = await healthRes.json();
          if (healthData.version) {
            document.getElementById("version-badge").textContent = "v" + healthData.version;
          }
        }
      } catch (_) {}

      try {
        var res = await fetch("/api/experiments");
        if (!res.ok) throw new Error("Server returned " + res.status);
        var data = await res.json();
        loading.classList.add("hidden");

        var expCount = (data.experiments || []).length;

        if (!data.experiments || expCount === 0) {
          empty.classList.remove("hidden");
          return;
        }

        searchBar.classList.remove("hidden");

        data.experiments.forEach(function (exp, i) {
          var card = document.createElement("div");
          card.className = "card card-animate";
          card.style.animationDelay = (i * 0.07) + "s";
          card.dataset.name = (exp.display_name || exp.name).toLowerCase();
          card.dataset.desc = (exp.description || "").toLowerCase();

          var titleRow = document.createElement("div");
          titleRow.className = "card-title";
          var titleText = document.createElement("span");
          titleText.textContent = exp.display_name || exp.name;
          titleRow.appendChild(titleText);
          if (exp.version) {
            var verBadge = document.createElement("span");
            verBadge.className = "card-version";
            verBadge.textContent = "v" + exp.version;
            titleRow.appendChild(verBadge);
          }
          var readmeIcon = document.createElement("a");
          readmeIcon.href = "/static/readme.html?exp=" + exp.name;
          readmeIcon.className = "card-readme-link";
          readmeIcon.title = "View README";
          readmeIcon.innerHTML = '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg> README';
          titleRow.appendChild(readmeIcon);
          card.appendChild(titleRow);

          if (exp.description) {
            var desc = document.createElement("div");
            desc.className = "card-desc";
            desc.textContent = exp.description;
            card.appendChild(desc);
          }

          if (exp.require_registration === false) {
            var meta = document.createElement("div");
            meta.className = "card-meta";
            var openBadge = document.createElement("span");
            openBadge.className = "badge badge-open";
            openBadge.textContent = "Open";
            openBadge.title = "No registration required";
            meta.appendChild(openBadge);
            card.appendChild(meta);
          }

          var sparkDiv = document.createElement("div");
          sparkDiv.className = "card-sparkline";
          sparkDiv.id = "spark-" + exp.name;
          card.appendChild(sparkDiv);

          var links = document.createElement("div");
          links.className = "card-links";

          var sc = exp.student_count || 0;
          var students = document.createElement("a");
          students.href = "/static/students.html?exp=" + exp.name;
          students.className = "card-link-admin";
          students.textContent = "Students (" + sc + ")";
          links.appendChild(students);

          var logsBtn = document.createElement("a");
          logsBtn.href = "/static/logs.html?exp=" + exp.name;
          logsBtn.className = "card-link-admin";
          logsBtn.id = "logs-btn-" + exp.name;
          logsBtn.textContent = "Logs";
          links.appendChild(logsBtn);

          var rightGroup = document.createElement("span");
          rightGroup.className = "card-links-admin";

          var fc = exp.function_count || 0;
          var funcs = document.createElement("a");
          funcs.href = "/static/functions.html?exp=" + exp.name;
          funcs.textContent = "Functions (" + fc + ")";
          rightGroup.appendChild(funcs);

          var open = document.createElement("a");
          open.href = "/exp/" + exp.name + "/ui/" + (exp.entry_point || "dashboard.html");
          open.className = "card-link-open";
          open.textContent = "Open";
          rightGroup.appendChild(open);

          links.appendChild(rightGroup);

          card.appendChild(links);
          grid.appendChild(card);
          allCards.push(card);
        });

        searchInput.addEventListener("input", function () {
          var q = this.value.toLowerCase().trim();
          var visible = 0;
          allCards.forEach(function (c) {
            var match = !q || c.dataset.name.indexOf(q) !== -1 || c.dataset.desc.indexOf(q) !== -1;
            c.style.display = match ? "" : "none";
            if (match) visible++;
          });
          noResults.classList.toggle("hidden", visible > 0);
        });

        function buildSparkline(buckets, color) {
          if (!buckets.length) return "";
          var max = Math.max.apply(null, buckets);
          if (max === 0) return "";
          var w = 200, h = 32, n = buckets.length;
          var step = w / (n - 1 || 1);
          var pts = buckets.map(function (v, i) {
            return (i * step).toFixed(1) + "," + (h - (v / max) * (h - 4) - 2).toFixed(1);
          });
          var fill = pts.concat([ w + ","+h, "0,"+h ]).join(" ");
          return '<svg viewBox="0 0 '+w+' '+h+'" preserveAspectRatio="none">' +
            '<polygon points="'+fill+'" fill="'+color+'" opacity="0.12"/>' +
            '<polyline points="'+pts.join(" ")+'" fill="none" stroke="'+color+'" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>' +
            '</svg>';
        }

        data.experiments.forEach(function (exp) {
          fetch("/exp/" + exp.name + "/log-options")
            .then(function (r) { return r.ok ? r.json() : {}; })
            .then(function (opts) {
              var lc = opts.log_count || 0;
              var logsEl = document.getElementById("logs-btn-" + exp.name);
              if (logsEl) logsEl.textContent = "Logs (" + lc + ")";
            }).catch(function () {});

          fetch("/exp/" + exp.name + "/logs?n=500&order=latest")
            .then(function (r) { return r.ok ? r.json() : { logs: [] }; })
            .then(function (d) {
              var logs = d.logs || [];
              if (logs.length < 2) return;
              var now = Date.now();
              var day = 86400000;
              var buckets = new Array(14).fill(0);
              logs.forEach(function (l) {
                var age = now - new Date(l.ts).getTime();
                var idx = 13 - Math.min(13, Math.floor(age / day));
                buckets[idx]++;
              });
              var el = document.getElementById("spark-" + exp.name);
              if (el) {
                el.innerHTML = buildSparkline(buckets, getComputedStyle(document.documentElement).getPropertyValue("--color-primary").trim()) +
                  '<span class="card-sparkline-label">last 14 days</span>';
              }
            }).catch(function () {});
        });

      } catch (err) {
        loading.classList.add("hidden");
        errorEl.textContent = "Failed to load experiments: " + err.message;
        errorEl.classList.remove("hidden");
      }
    })();
  </script>
</body>
</html>
